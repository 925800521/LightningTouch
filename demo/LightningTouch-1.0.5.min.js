/**
 * Lightning Touch makes links responsive without the several
 * hundred millisecond delay typical in a hendheld touchscreen browser.
 * 
 * Click events can take 300 ms or so to register on a mobile device because 
 * the device is waiting to see if it's a double click or a touch-and-drag 
 * event.  Use touchStart etc. to work around this issue, but it's not as 
 * straightforward as one might hope.
 * 
 * This code started with a portion of fastButtons created and shared by Google
 * and used according to terms described in the Creative Commons 3.0 Attribution
 * License.  fastButtons can be found at: 
 * http://code.google.com/mobile/articles/fast_buttons.html
 *
 * @module Lightning Touch
 * @author Rich Trott
 * @copyright Copyright (c) 2012 UC Regents
 * @version 1.0.1
 *//*global document: false, history: false, location: false, window: false */(function(){"use strict";var e=[],t=[],n=[],r,i,s,o,u,a,f,l,c,h,p;f=[],l=function(){f.splice(0,2)},c=function(e,t){f.push(e,t),window.setTimeout(l,2500)},h=function(e){var t,n,r;for(t=0;t<f.length;t+=2)n=f[t],r=f[t+1],Math.abs(e.clientX-n)<25&&Math.abs(e.clientY-r)<25&&(e.stopPropagation(),e.preventDefault())},document.addEventListener("click",h,!0),i=function(e,t){this.element=e,this.handler=t,e.addEventListener("touchstart",this,!1),e.addEventListener("click",this,!1)},i.prototype.handleEvent=function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onClick(e);break;case"click":this.onClick(e)}},i.prototype.onTouchStart=function(e){e.stopPropagation(),this.element.addEventListener("touchend",this,!1),document.body.addEventListener("touchmove",this,!1),this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY},i.prototype.onTouchMove=function(e){(Math.abs(e.touches[0].clientX-this.startX)>10||Math.abs(e.touches[0].clientY-this.startY)>10)&&this.reset()},i.prototype.onClick=function(e){e.stopPropagation(),this.reset(),this.handler(e),e.type==="touchend"&&c(this.startX,this.startY)},i.prototype.reset=function(){this.element.removeEventListener("touchend",this,!1),document.body.removeEventListener("touchmove",this,!1)},s=function(e,r){var i=n.indexOf(r);i<0&&(i=n.length,n.push(r)),t[i]=e},o=function(e,t,n){n=n||location.pathname+location.hash,s(e,n),history.replaceState(e,t,n)},u=function(e){var r=e?location.pathname+"#/"+e:location.pathname+location.hash,i=n.indexOf(r);return i<0?undefined:t[i]},a=function(e,t){return e.indexOf(t)<0&&e.push(t),e},p=function(){function c(e,t){var n,i,s;i=document.getElementById(e)||document.getElementById(r);if(i){for(s=0;s<t.length;s+=1)n=document.getElementById(t[s]),n&&n.setAttribute("style","display:none");i.setAttribute("style","display:block")}}var t,n,f,l;r=document.body.getAttribute("data-default-target-id")||"",!location.hash&&r!==""&&(location.hash="#/"+r),c(location.hash.substring(2),[r]);if(!(history instanceof Object&&history.replaceState instanceof Function))return;f=function(e){var t,n,i,s,f,l;t=this.element.getAttribute("data-target-id"),n=document.getElementById(t),n!==null&&(e.preventDefault(),i=document.getElementById(location.hash.substr(2)),s=i?i.getAttribute("id"):r,c(t,[s]),f=u(),l=f&&f.hasOwnProperty("hide")?a(f.hide,t):[t],o({show:s,hide:l},""),location.hash="#/"+t,f=u(),l=f&&f.hasOwnProperty("hide")?a(f.hide,s):[s],o({show:t,hide:l},""))},t=document.getElementsByTagName("a");for(n=0;n<t.length;n+=1)t[n].getAttribute("data-target-id")!==null&&e.push(new i(t[n],f));l=function(e){var t,r,i;t=u(),t&&c(t.show,t.hide);if(e.state){for(n=0;n<e.state.hide.length;n+=1)r=u(e.state.hide[n]),r&&(i=a(r.hide,e.state.show),s({show:e.state.hide[n],hide:i},location.pathname+"#/"+e.state.hide[n]));c(e.state.show,e.state.hide)}},window.addEventListener("popstate",l,!1)},document.readyState==="complete"||document.readyState==="interactive"?p():document.addEventListener("DOMContentLoaded",p,!1)})();